<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Hash λ Bye - Manage page state and sub-components with React.js</title>
        <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script>
        </script>
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Hash λ Bye</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html"><i class="fa fa-user"></i>About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Manage page state and sub-components with React.js</h1>

            <div class="info">
    Posted on September 25, 2015
    
</div>

<p><em>注意事項</em></p>
<p>ここで書いたReact.jsのstateに対するアプローチの正しさには議論の余地がありそうです。</p>
<p>最後にも書きましたが、Componentにstateを保持させること自体が原則的に忌避されるべきであるようです。</p>
<h2 id="問題の発見">問題の発見</h2>
<p>React.jsでUIを組み上げる過程ですごく悩んだのが、 複数のComponentを組み合わせて一つのページを作成するときに どこにstateを持たせておくか、ということです。</p>
<pre><code>Home.js
  LoginForm.js</code></pre>
<p>という包含関係だった場合に、stateを<code>Home</code>と<code>LoginForm</code>のどちらで 管理させるかという問題です。</p>
<p>Reactは原則的に「<em><code>state</code>は最小限にして、できる限り全てを<code>props</code>として入力せよ</em>」というような哲学を推奨しているようです。</p>
<p>これを極端に推し進めるとトップレベルのComponentが保持するstateをowneeのpropsに渡していく方法が正解ということになります。 公式の解説は下記のリンクをご参照ください。</p>
<p><a href="https://facebook.github.io/react/docs/multiple-components.html#data-flow">Multiple Components</a></p>
<p><a href="http://mizchi.hatenablog.com/entry/2015/08/24/233919">Reactのprops/stateとFluxのStore</a></p>
<p>ここでポイントとなるのは<em>owneeで起こる入力イベントをどうハンドルするか</em>です。</p>
<p>例として下記のようにHome画面にLoginFormというフォームを持たせることを考えます。</p>
<pre><code>/**
 * フォームを含むページ全体のインスタンス
 */
class Home extends Component {
  render() {
    return (
      &lt;div&gt;
        &lt;LoginForm/&gt;
      &lt;/div&gt;
    );
  }
}

/**
 * ユーザの認証情報を入力するフォーム
 */
class LoginForm extends Component {
  render() {
    return (
      &lt;form&gt;
        &lt;fieldset&gt;
          &lt;input type='text'/&gt;
          &lt;input type='password'/&gt;
          &lt;button type='submit'&gt;Login&lt;/button&gt;
        &lt;/fieldset&gt;
      &lt;/form&gt;
    );
  }
}
</code></pre>
<p>これをReactらしく下記のルールに従って書き換えていきます。</p>
<ul>
<li>データは常にOwnerからOwneeへと流れます。</li>
<li>Owneeは常に<code>props</code>しか受け取らず<code>state</code>を持ちません。</li>
<li>Owneeはローカル<code>state</code>を持つ代わりに変更のイベントを上位コンポーネントを通知します。</li>
</ul>
<h2 id="ケーススタディ">ケーススタディ</h2>
<p>React.jsではTwo-way bindingの項でこれに言及していました。 <a href="https://facebook.github.io/react/docs/two-way-binding-helpers.html">Two-Way Binding Helpers</a></p>
<p>たぶんこんな感じでデータが流れるのが <em>React-way</em> なのだと理解しています。</p>
<pre><code>                  Data Flow

      props       props       props
Owner ----&gt; Ownee ----&gt; Ownee ----&gt; Ownee
              |           |           | onChange
  &lt;-----------+-----------+-----------+

                  Event Flow</code></pre>
<p>上位から下位へとデータをパスしていきDOMを生成する一種のストリーム処理みたいですね。</p>
<p>上記のように美しいデータフローが実現できるかは微妙ですが、 前述のHomeとLoginFormを少しずつ書き換えてReact-wayなデータフローを作ってみましょう。</p>
<h3 id="その1-bad-practiceから始める">その1: Bad practiceから始める</h3>
<p>ここで事切れるぼく。</p>
<h2 id="よりよい方法">よりよい方法</h2>
<p>とにかく内部的な状態を可能な限り排除して、ReactComponentを純粋関数のように仕上げていくことが、より堅牢なUIを構築するためには必要なようです。</p>
<p>つまりトップレベルのComponentですらstateを持たないということになります。</p>
<p>現時点では「Fluxアーキテクチャを導入した上でStoreに全ての状態を集約するのかな」と想像していますがまだ答えを見つけていません。</p>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
