------------------
title: 代数的データ型へと翻訳する#01
date: 2015-10-19
tags: [haskell, functional programming]
------------------

はじめに
=====

Haskellはその豊かな型システムを用いることで強力な表現力を獲得しています。
でもその表現力を使いこなすためは、私たちもいくばくかのスキルをつけなければなりません。

その中でもいま私が一番重要だと考えているのが、

*問題を代数的データ型で表現するスキル*

です。

このスキルが不十分だとデータ型を関数上で扱うときに不必要なboiler plateが多発したり、
必要な拡張ができなくなったり、最悪解決したい問題すら解決できません。


*Haskellにおいてはデータ型の設計は生命線なのです。*


この記事ではいま私自身が直面している問題領域を代数的データ型へと
翻訳していく過程を記します。

そしてその途中では練習と称してよく見かける問題も代数的データ型へと翻訳してみようと思います。

翻訳という考え方は最近読んでいる新井紀子さんの名著『[数学は言葉](http://www.amazon.co.jp/dp/4489020538)』からインスパイアされました。
言葉で表された問題を分析して数式に翻訳していく営みが美しいと感じました。
同じことがHaskellのADT（代数的データ型）でもできるのではないかと思っています。

問題をよりよいデータ型で表現したいです。
ただそれだけです。

問題の発見
==========

Sqliteのデータベースへデータ登録を行ったり、
ファイルシステムとのIOを行ったりするようなCLIをもつアプリケーションを作っています。

[lycopene](https://github.com/utky/lycopene)

サーバを立ち上げずに軽くBacklogの管理をしたいな、と思ったのがきっかけで作り始めました。
しかしDBとのIOの絡んだテストコードでは、思うように結果セットからデータを引き出せないなど
数々の問題に直面することになりました。

その時の問題の切り分けのしにくさに我がコードながら辟易し始めました。

よかれと思って書いた自分のコードのデータ設計は本当に正しいのだろうか？

一時期調子に乗ってFreeモナドを導入したあたりで何かシンプルで良いものが失われた気がしました。


問題領域をよく表現した見通しのよいデータ型で再設計をし、
スマートに目的を達成するのが実は一番近道なのだと思うようになりました。

見通しのよいデータ型を設計するためにも、
関心を持った問題領域を代数的データ型（ADT）へと翻訳していくのが良さそうだとあたりをつけました。

ここからは言葉とADTの変換を中心に書いていこうと思います。


ドメイン
--------

今回作りたいアプリケーションではBacklog管理と時間計測を行いたいと考えています。
まずは解決するべき問題であるドメインの整理から始めます。

ドメインはデータベース技術やユーザインタフェースに依存せず純粋に
保たれなければいけないため、何より最初に設計を始められる部分でもあります。
逆にデータベースとの接続や外部API呼び出しを考慮しなければいけないような場面に出くわした場合、
それはドメインを純粋に保てていない危険信号と捉えるべきです。

まずはBacklogの構成要素となるユーザーストーリーに相当する`Issue`、
そして`Issue`に対してとりかかった作業の実績時間`TimeTrack`を定義します。

```haskell
IssueとTimeTrackを入れる
```

これらのデータ型は値を格納することを目的としたデータコンテナの一種です。
計算の振る舞いに関する記述は持ちません。


一方でドメイン内で起こった変更が永続化されるべきであることを、
ドメイン外部へ伝えるためのインタフェースが必要です。

```haskell
```
